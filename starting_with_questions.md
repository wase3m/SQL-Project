Answer the following questions and provide the SQL queries used to find the answer.

    
**Question 1: Which cities and countries have the highest level of transaction revenues on the site?**


SQL Queries: 
For countries :
SELECT
    als.country,
    AVG(a.units_sold)::NUMERIC(10,2) AS average_units_sold
FROM all_sessions AS als
JOIN analytics AS a USING (visitid)
GROUP BY als.country
ORDER BY average_units_sold DESC
LIMIT 100;

For Cities :




Answer:




**Question 2: What is the average number of products ordered from visitors in each city and country?**


SQL Queries:

For countries :
SELECT
    als.country,
    AVG(a.units_sold)::NUMERIC(10,2) AS average_units_sold
FROM all_sessions AS als
JOIN analytics AS a USING (visitid)
GROUP BY als.country
ORDER BY average_units_sold DESC
LIMIT 100;

For Cities :

SELECT
    als.country,als.city,
    SUM(a.units_sold)::NUMERIC(10,2) AS total_sales
FROM all_sessions AS als
JOIN analytics AS a USING (visitid)
GROUP BY als.country, als.city
ORDER BY total_sales DESC
LIMIT 100;



Answer:

We see that **United States** and **New York** have the highest average number of products ordered.



**Question 3: Is there any pattern in the types (product categories) of products ordered from visitors in each city and country?**


SQL Queries:

For Countries :
SELECT
    als.country,
    --als.city,
    v2productcategory,
    COUNT(*) AS order_count
FROM all_sessions AS als
GROUP BY als.country, v2productcategory
ORDER BY order_count DESC  --als.country, order_count DESC
LIMIT 100;

Answer:

We see that visitors from United States buy 'Men's T-shirt' the most
We see that visitors from Mountain View city buy 'Men's T-shirt' the most



**Question 4: What is the top-selling product from each city/country? Can we find any pattern worthy of noting in the products sold?**


SQL Queries:

For City:

WITH top_products AS (
    SELECT
        als.country,
		als.city,
        v2productname,
        COUNT(*) AS order_count,
        ROW_NUMBER() OVER (PARTITION BY als.country, als.city ORDER BY COUNT(*) DESC) AS top
    FROM all_sessions AS als
    GROUP BY als.country,als.city, v2productname
)
SELECT
    country,
	city,
    v2productname,
    order_count
FROM top_products
WHERE top = 1
ORDER BY country, city DESC;

For Country :

WITH top_products AS (
    SELECT
        als.country,
        v2productname,
        COUNT() AS order_count,
        ROW_NUMBER() OVER (PARTITION BY als.country ORDER BY COUNT() DESC) AS top
    FROM all_sessions AS als
    GROUP BY als.country, v2productname
)
SELECT
    country,
    v2productname,
    order_count
FROM top_products
WHERE top = 1
ORDER BY country DESC;

Answer:

With the queries above we can find all the top products of each country and city



**Question 5: Can we summarize the impact of revenue generated from each city/country?**

SQL Queries:

SELECT 
    country,
    --city, (add for city)
    SUM(revenue) AS rev
FROM analytics
JOIN all_sessions USING (visitid)
GROUP BY country --city (add for city)
ORDER BY rev DESC

Answer:

We can see the amount of revenue generated by each city and country 





